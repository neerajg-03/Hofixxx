{% extends 'base.html' %}
{% block content %}
<h2>Manage Services</h2>
<form id="serviceForm" class="row g-3 col-lg-8 card p-3 shadow-sm" enctype="multipart/form-data">
  <div class="col-md-6">
    <label class="form-label">Name</label>
    <input name="name" class="form-control" required />
  </div>
  <div class="col-md-6">
    <label class="form-label">Category</label>
    <input name="category" class="form-control" required />
  </div>
  <div class="col-md-6">
    <label class="form-label">Base Price</label>
    <input name="base_price" type="number" step="0.01" class="form-control" required />
  </div>
  <div class="col-md-6">
    <label class="form-label">Image</label>
    <input name="image" type="file" accept="image/*" class="form-control" />
  </div>
  <div class="col-md-6">
    <label class="form-label">Latitude</label>
    <input name="location_lat" id="lat" class="form-control" />
  </div>
  <div class="col-md-6">
    <label class="form-label">Longitude</label>
    <input name="location_lon" id="lon" class="form-control" />
  </div>
  <div class="col-12 d-flex align-items-center">
    <button class="btn btn-primary" type="submit">Create Service</button>
    <button id="geoBtn" type="button" class="btn btn-outline-secondary ms-2">Use my location</button>
  </div>
</form>
<div id="svcMsg" class="mt-3"></div>
{% endblock %}
{% block scripts %}
<script>
function fillGeo(){
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(pos => {
      document.getElementById('lat').value = pos.coords.latitude;
      document.getElementById('lon').value = pos.coords.longitude;
    });
  }
}
document.getElementById('geoBtn').addEventListener('click', fillGeo);
fillGeo();

const form = document.getElementById('serviceForm');
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const token = localStorage.getItem('token') || '';
  const fd = new FormData(form);
  const res = await fetch('/services', { method: 'POST', headers: { 'Authorization': `Bearer ${token}` }, body: fd });
  const out = await res.json();
  if (res.ok) {
    document.getElementById('svcMsg').textContent = `Service created #${out.id}`;
    form.reset(); fillGeo();
  } else {
    document.getElementById('svcMsg').textContent = out.message || 'Failed';
  }
});
</script>
{% endblock %}













